<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Manage Gallery - Admin Panel</title>
    <link rel="stylesheet" href="/css/style.css">
    <link rel="stylesheet" href="/css/admin.css">
</head>
<body>
    <div class="admin-container">
        <aside class="admin-sidebar">
            <div class="admin-sidebar-header">
                <h2>ğŸŒŸ Trust Admin</h2>
                <p id="admin-username">Admin</p>
            </div>
            <ul class="admin-menu">
                <li><a href="/admin/dashboard.html">ğŸ“Š Dashboard</a></li>
                <li><a href="/admin/programs.html">ğŸ“š Programs</a></li>
                <li><a href="/admin/gallery.html" class="active">ğŸ–¼ï¸ Gallery</a></li>
                <li><a href="/admin/announcements.html">ğŸ“¢ Announcements</a></li>
                <li><a href="/admin/enquiries.html">âœ‰ï¸ Enquiries</a></li>
                <li><a href="/admin/reports.html">ğŸ“„ Reports</a></li>
                <li><a href="#" onclick="logout()">ğŸšª Logout</a></li>
            </ul>
        </aside>

        <main class="admin-main">
            <header class="admin-header">
                <h1>Manage Gallery</h1>
                <button class="btn" onclick="document.getElementById('uploadModal').classList.add('active')">+ Upload Image</button>
            </header>

            <div class="admin-content">
                <div class="content-card">
                    <div id="gallery-container" class="gallery-grid" style="gap: 1rem;">
                        <div class="loader"></div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <div id="uploadModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Upload Image</h2>
                <span class="modal-close" onclick="document.getElementById('uploadModal').classList.remove('active')">&times;</span>
            </div>
            <form id="uploadForm">
                <div class="form-group">
                    <label>Image *</label>
                    <input type="file" id="image-file" accept="image/*" required>
                </div>
                <div class="form-group">
                    <label>Title</label>
                    <input type="text" id="image-title">
                </div>
                <div class="form-group">
                    <label>Description</label>
                    <textarea id="image-description" rows="3"></textarea>
                </div>
                <button type="submit" class="btn" style="width: 100%;">Upload</button>
            </form>
        </div>
    </div>

    <script src="/js/admin.js"></script>
    <script>
        async function loadGallery() {
            const container = document.getElementById('gallery-container');
            try {
                const images = await adminApiCall('/api/gallery');
                if (images.length === 0) {
                    container.innerHTML = '<div class="empty-state" style="grid-column: 1/-1;"><div class="empty-state-icon">ğŸ–¼ï¸</div><p>No images yet</p></div>';
                    return;
                }

                container.innerHTML = images.map(img => `
                    <div class="card">
                        <img src="${img.image_url}" class="card-image" alt="${img.title}">
                        <div class="card-content">
                            <h3>${img.title || 'Untitled'}</h3>
                            <p>${img.description || ''}</p>
                            <button class="btn btn-small btn-delete" onclick="deleteImage(${img.id})" style="width: 100%; margin-top: 1rem;">Delete</button>
                        </div>
                    </div>
                `).join('');
            } catch (error) {
                container.innerHTML = '<p style="color: var(--accent-color); grid-column: 1/-1;">Failed to load gallery</p>';
            }
        }

        async function deleteImage(id) {
            if (!confirmAction('Delete this image?')) return;
            try {
                await adminApiCall(`/api/gallery/${id}`, { method: 'DELETE' });
                showAdminNotification('Image deleted');
                loadGallery();
            } catch (error) {
                showAdminNotification('Failed to delete', 'error');
            }
        }

        document.getElementById('uploadForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const formData = new FormData();
            formData.append('image', document.getElementById('image-file').files[0]);
            formData.append('title', document.getElementById('image-title').value);
            formData.append('description', document.getElementById('image-description').value);

            try {
                await fetch('/api/gallery', { method: 'POST', body: formData }).then(res => res.json());
                showAdminNotification('Image uploaded');
                document.getElementById('uploadModal').classList.remove('active');
                document.getElementById('uploadForm').reset();
                loadGallery();
            } catch (error) {
                showAdminNotification('Upload failed', 'error');
            }
        });

        document.addEventListener('DOMContentLoaded', () => {
            setActiveMenu('gallery');
            loadGallery();
        });
    </script>
</body>
</html>
