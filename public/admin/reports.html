<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Manage Reports - HopeHarbor Foundation</title>
    <link rel="icon" type="image/svg+xml" href="/images/favicon.svg">
    <link rel="stylesheet" href="/css/style.css">
    <link rel="stylesheet" href="/css/admin.css">
</head>
<body>
    <div class="admin-container">
        <aside class="admin-sidebar">
            <div class="admin-sidebar-header">
                <h2>âš“ HopeHarbor Admin</h2>
                <p id="admin-username">Admin</p>
            </div>
            <ul class="admin-menu">
                <li><a href="/admin/dashboard.html">ğŸ“Š Dashboard</a></li>
                <li><a href="/admin/programs.html">ğŸ“š Programs</a></li>
                <li><a href="/admin/gallery.html">ğŸ–¼ï¸ Gallery</a></li>
                <li><a href="/admin/announcements.html">ğŸ“¢ Announcements</a></li>
                <li><a href="/admin/enquiries.html">âœ‰ï¸ Enquiries</a></li>
                <li><a href="/admin/reports.html" class="active">ğŸ“„ Reports</a></li>
                <li><a href="#" onclick="logout()">ğŸšª Logout</a></li>
            </ul>
        </aside>

        <main class="admin-main">
            <header class="admin-header">
                <h1>Manage Reports</h1>
                <button class="btn" onclick="document.getElementById('uploadModal').classList.add('active')">+ Upload Report</button>
            </header>

            <div class="admin-content">
                <div class="content-card">
                    <div id="reports-container"><div class="loader"></div></div>
                </div>
            </div>
        </main>
    </div>

    <div id="uploadModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Upload Report</h2>
                <span class="modal-close" onclick="document.getElementById('uploadModal').classList.remove('active')">&times;</span>
            </div>
            <form id="uploadForm">
                <div class="form-group">
                    <label>PDF File *</label>
                    <input type="file" id="report-file" accept="application/pdf" required>
                </div>
                <div class="form-group">
                    <label>Title *</label>
                    <input type="text" id="report-title" required>
                </div>
                <div class="form-group">
                    <label>Description</label>
                    <textarea id="report-description" rows="3"></textarea>
                </div>
                <div class="form-group">
                    <label>Year</label>
                    <input type="number" id="report-year" min="2000" max="2100" value="2026">
                </div>
                <button type="submit" class="btn" style="width: 100%;">Upload Report</button>
            </form>
        </div>
    </div>

    <script src="/js/admin.js"></script>
    <script>
        async function loadReports() {
            const container = document.getElementById('reports-container');
            try {
                const reports = await adminApiCall('/api/reports');
                if (reports.length === 0) {
                    container.innerHTML = '<div class="empty-state"><div class="empty-state-icon">ğŸ“„</div><p>No reports yet</p></div>';
                    return;
                }

                container.innerHTML = `<div class="table-container"><table>
                    <thead><tr><th>Title</th><th>Year</th><th>Uploaded</th><th>Actions</th></tr></thead>
                    <tbody>${reports.map(report => `
                        <tr>
                            <td><strong>${report.title}</strong><br><small style="color: var(--text-light);">${report.description || ''}</small></td>
                            <td>${report.year}</td>
                            <td>${formatDate(report.upload_date)}</td>
                            <td><div class="btn-group">
                                <a href="${report.file_url}" target="_blank" class="btn btn-small btn-view">Download</a>
                                <button class="btn btn-small btn-delete" onclick="deleteReport(${report.id})">Delete</button>
                            </div></td>
                        </tr>
                    `).join('')}</tbody>
                </table></div>`;
            } catch (error) {
                container.innerHTML = '<p style="color: var(--accent-color);">Failed to load</p>';
            }
        }

        async function deleteReport(id) {
            if (!confirmAction('Delete this report?')) return;
            try {
                await adminApiCall(`/api/reports/${id}`, { method: 'DELETE' });
                showAdminNotification('Deleted');
                loadReports();
            } catch (error) {
                showAdminNotification('Failed', 'error');
            }
        }

        document.getElementById('uploadForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const formData = new FormData();
            formData.append('file', document.getElementById('report-file').files[0]);
            formData.append('title', document.getElementById('report-title').value);
            formData.append('description', document.getElementById('report-description').value);
            formData.append('year', document.getElementById('report-year').value);

            try {
                await fetch('/api/reports', { method: 'POST', body: formData }).then(res => res.json());
                showAdminNotification('Report uploaded');
                document.getElementById('uploadModal').classList.remove('active');
                document.getElementById('uploadForm').reset();
                loadReports();
            } catch (error) {
                showAdminNotification('Upload failed', 'error');
            }
        });

        document.addEventListener('DOMContentLoaded', () => {
            setActiveMenu('reports');
            loadReports();
        });
    </script>
</body>
</html>
